<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!--Inherit sale order from view to add split sale order related buttons-->
    <record id="view_sale_order_split_button_form" model="ir.ui.view">
        <field name="name">sale.order.form.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button
                    class="oe_stat_button"
                    type="object"
                    name="action_split_orders"
                    groups="sales_team.group_sale_manager"
                    icon="fa-dollar"
                    invisible="not split_order_count"
                >
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Split</span>
                        <span class="o_stat_text">Orders</span>
                    </div>
                    <field name="split_order_count" invisible="1" />
                </button>
            </xpath>
            <xpath expr="//header" position="inside">
                <button
                    name="action_pend"
                    string="Pasar a pendiente"
                    type="object"
                    invisible="state not in ('by_authorize')"
                    groups="sales_team.group_sale_manager"
                    class="btn-primary"
                />
                <button
                    name="action_confirm"
                    string="Confirmar"
                    type="object"
                    invisible="state not in ('pend')"
                    groups="sales_team.group_sale_manager"
                    class="btn-primary"
                />
                <button
                    name="action_split_sale_order_quotation"
                    string="Split Sales Order"
                    type="object"
                    invisible="state not in ('draft', 'sent')"
                    groups="sales_team.group_sale_manager"
                    class="btn-primary"
                />

                <div>
                    <div>
                        <field name="checklist_state_progress" widget="percentpie" string=""/>
                    </div>
                </div>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="delivered_count" invisible="1"/>
                <field name="total_count" invisible="1"/>
                <field name="delivery_state_progress" widget="percentpie" string="Progress"/>
                <field
                    name="split_sale_order_id"
                    invisible="not split_sale_order_id"
                    readonly="1"
                />
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page name="qty_delivered" string="Cantidades entregadas">
                     <field name="lines_delivered_ids" nolabel="1">
                        <tree edit="False" >
                            <field name="x_sale_order"/>
                            <field name="x_order_line_id"/>
                            <field name="x_pedido_id"/>
                            <field name="qty_delivered"/>
                            <field name="product_uom_qty"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="split_sale_order_tree_views_inehrit" model="ir.ui.view">
        <field name="name">split.sale.order.tree.views.inehrit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>
        <field name="arch" type="xml">
            <field name="state" position="before">
                <field name="delivery_state_progress" widget="percentpie" string="Progress"/>
            </field>
        </field>
    </record>

</odoo>
