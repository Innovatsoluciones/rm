<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="l4l_sale_order_kpis_tree_inherit_sale_split" model="ir.ui.view">
        <field name="name">l4l.sale.order.kpis.tree.inherit.sale.split</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>
        <field name="arch" type="xml">
            <field name="state" position="before">
                <field name="delivery_state_progress" widget="percentpie" string="Progreso de estado"/>
            </field>
        </field>
    </record>

    <record id="l4l_split_sale_views_form" model="ir.ui.view">
        <field name="name">l4l.split.sale.views.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="split_order_count" invisible="1" />
                <button name="action_split_smart_button" type="object" class="oe_stat_button"
                        icon="fa-pencil-square-o" invisible="split_order_count == 0">
                        <field name="split_order_count" widget="statinfo" string="Documentos relacionados"/>
                    </button>
            </xpath>
            <xpath expr="//sheet/div[1]" position="before">
                <field name="order_line_count" invisible="1"/>
                <widget name="web_ribbon" title="Completado" bg_color="text-bg-info"
                        invisible="order_line_count > 1 or (order_line_count == 0 and split_order_count == 0)"/>
            </xpath>
            <xpath expr="//header" position="inside">
                <div>
                    <div>
                        <field name="checklist_state_progress" widget="percentpie" string=""/>
                    </div>
                </div>
            </xpath>
            <xpath expr="//button[@name='action_confirm'][1]" position="replace">
                <button name="action_pend" string="Pasar a pendiente" type="object" class="btn-primary"
                        invisible="state not in ('by_authorize')" groups="sales_team.group_sale_manager" />
                <button name="button_split_order" string="Dividir" type="object" invisible="state not in ('draft')"
                    class="oe_highlight"/>
                <button name="action_confirm" string="Confirmar" type="object" invisible="state not in ('draft', 'pend')"
                    groups="sales_team.group_sale_manager" class="btn-primary" />
            </xpath>
            <xpath expr="//button[@name='action_confirm'][2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="delivered_count" invisible="1"/>
                <field name="total_count" invisible="1" />
                <field name="delivery_state_progress" widget="percentpie" string="Progress"/>
                <field name="sale_origin_id" invisible="not sale_origin_id" readonly="1" force_save="1"/>
            </xpath>

            <xpath expr="//notebook" position="inside">
                <page name="qty_delivered" string="Cantidades entregadas">
                     <field name="lines_delivered_ids" nolabel="1">
                        <tree edit="False" >
                            <field name="order_id"/>
                            <field name="x_order_line_id"/>
                            <field name="x_so_order_id"/>
                            <field name="qty_delivered"/>
                            <field name="product_uom_qty"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>